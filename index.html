<!DOCTYPE html>
<title>Yew's RogueLike</title>
<link rel="icon" type="image/x-icon" href="images/favicon.ico">
<link rel="stylesheet" href="styles.css">

<body>
    <img id="audioSymbol" src="images/img.png" onclick="muteAudio()"/>
</body>

<canvas id="layer1" style="z-index: 1;" />
<canvas id="layer2" style="z-index: 2;" />

<div style="display:none;">
  <img id="rp0image"
       src="images/spritesheet.png"
       width="512" height="16">
</div>

<label for="tentacles">Number of tentacles (10-100):</label>

<input type="number" id="tentacles" name="tentacles"
       min="10" max="100">

<script src="js/animation.js"></script>
<script src="js/audio.js"></script>
<script src="js/cutscene.js"></script>
<script src="js/game.js"></script>
<script src="js/map.js"></script>
<script src="js/tile.js"></script>
<script src="js/monster.js"></script>
<script src="js/util.js"></script>
<script src="js/spell.js"></script>
<script src="js/sword.js"></script>
<script src="js/armor.js"></script>
<script src="js/Controller/Controller.min.js"></script>
<script src="js/Controller/Controller.layouts.min.js"></script>
<script src="js/Controller/controllerInputs.js"></script>

<script>
    moonShoes = false;
    eaterSoul = false;
    tileSize = 64;
    numTiles = 9;
    uiWidth = 4;
    level = 1;
    maxHp = 12;

    spritesheet = new Image();
    spritesheet.src = 'images/spritesheet.png';
    spritesheet.onload = showTitle;
                             
    gameState = "loading";  

    startingHp = 3; 
    numLevels = 26;    

    shakeAmount = 0;       
    shakeX = 0;                 
    shakeY = 0;

    pX = 0;
    pY = 0;     
    playerDirection = "down";

    boss2bButtonRCooldown = 0;    

    document.querySelector("html").onkeypress = function(e){
        console.log(e.key);
        if(gameState == "title"){
            animatingTitle = false;
            gameState = "rpSection0";
            showRpSection0();                              
        }else if(gameState === "rpSection0"){
            animating = false;
            gameState = "running";
            pauseSound('rpSection0Music');
            startGame();              
        }else if(gameState === "rpSection1"){
            animatingSection1 = false;
            startBossLevel(Math.min(maxHp, player.hp+1),undefined, player.baseAttack);
            section1Number = 0;
        }else if(gameState === "rpSection2"){
            if(e.key=="1"){
                moonShoes = true;
                cancelAnimationFrame(myReq);
                gameState = "rpSection3";
                showRpSection3();
                pauseSound('music');
                pauseSound('musicMenuMuffled'); 
                pauseSound('bossmusic');
            }
            if(e.key=="2"){
                eaterSoul = true;
                cancelAnimationFrame(myReq);
                gameState = "rpSection4"
                showRpSection4();
                pauseSound('music');
                pauseSound('musicMenuMuffled'); 
                pauseSound('bossmusic');
            } 
        }else if(gameState === "rpSection3"){
            ctx.shadowBlur = 0;
            animatingMutationSelection1 = false;
            cancelAnimationFrame(myReq);
            pauseSound('transitionMusic2a');
            ctx.restore();
            startLevel(Math.min(maxHp, player.hp+1),undefined, player.baseAttack);
        }else if(gameState === "rpSection4"){
            ctx.shadowBlur = 0;
            animatingMutationSelection1 = false;
            cancelAnimationFrame(myReq);
            pauseSound('transitionMusic2b');
            playSound('music3');
            playSound('music3MenuMuffled');
            level = 14;
            ctx.restore();
            startLevel(Math.min(maxHp, player.hp+1),undefined, player.baseAttack);
        }else if(gameState === "rpSection5"){
            animatinglevel2aCutscene = false;
            cancelAnimationFrame(myReq);
            startLevel(Math.min(maxHp, player.hp+1),undefined, player.baseAttack);
        }else if(gameState === "rpSection6"){
            animatingCutscene1 = false;
            cancelAnimationFrame(myReq);
            ctx.shadowBlur = 0;
            pauseSound('rpSection0Music'); 
            startLevel(Math.min(maxHp, player.hp+1),undefined, player.baseAttack);
        }else if(gameState === "interactiveSection1"){
            if(e.key=="w"){
                interactiveX1 -= 55;
                console.log(interactiveX1);
                showInteractiveSection1(); 
            }
            if(e.key=="s"){
                interactiveX1 += 55;
                console.log(interactiveX1);
                showInteractiveSection1(); 
            }
            if(e.key=="d"){
                interactiveY1 += 89;
                console.log(interactiveY1);
                showInteractiveSection1(); 
            }
            if(e.key=="a"){
                interactiveY1 -= 89;
                console.log(interactiveY1);
                showInteractiveSection1(); 
            }
            if(e.key=="Enter" && interactiveY1 === 89 && interactiveX1 === 55){
                showInteractiveSection2();
            }

        }else if(gameState == "dead"){             
            showTitle();
            pauseAllMusic();                                      
        }else if(gameState == "running"){
            if(animatingLevel2aTooltip === true){
                    animatingLevel2aTooltip = false;
                    cancelAnimationFrame(myReq);
                    sounds.music2.muted = false;
                    return;                
            }

            if (showOptions === true){
                if (e.key=="s"){
                    playSound('menuScrollDown');
                    optionsSelector += 1;
                    console.log(optionsSelector);
                }else if(e.key=="w"){
                    playSound('menuScrollUp');
                    optionsSelector -= 1;
                    console.log(optionsSelector);
                }

                if(e.key=="Enter" && optionsSelector === 1){
                    playSound('menuSelect');
                    showOptions = false;
                    showDevtools = true;
                    devtoolsSelectorY = 0;
                    showDevtoolsMenu();

                }else if(e.key=="Enter" && optionsSelector === 2){
                    playSound('menuSelect');
                    showOptions = false;
                    showGraphics = true;
                    showGraphicsMenu();
                }else if(e.key=="Enter" && optionsSelector === 3){
                    playSound('menuClose');
                    sounds.musicMenuMuffled.muted = true;
                    sounds.music.muted = false;

                    showOptions = false;

                    cancelAnimationFrame(myReq);
                }

                //allowing continuous scrolling through top/bottom
                if (optionsSelector > 3){
                    optionsSelector = 1;
                }else if(optionsSelector <= 0){
                    optionsSelector = 3;
                }

                return;    
            }

            if (showDevtools === true){

                if (event.key === "Enter" && devtoolsSelectorY === 1){

                    if (level <= 5){
                        playSound('menuSelect');
                        showDevtools = false;
                        cancelAnimationFrame(myReq);
                        sounds.musicMenuMuffled.muted = true;
                        sounds.music.muted = false;

                        startLevel();
                        playSound("music");
                        playSound("musicMenuMuffled"); 
                
                    }else if (level === 6){
                        playSound('menuSelect');
                        showDevtools = false;
                        cancelAnimationFrame(myReq);
                        startBossLevel();

                        
                    }else if(level >= 7 && level <= 13){
                        playSound('menuSelect');
                        showDevtools = false;
                        cancelAnimationFrame(myReq);
                        startLevel();

                        pauseSound('music');
                        pauseSound('musicMenuMuffled');
                        pauseSound('music3');
                        pauseSound('music3MenuMuffled');
                        playSound("music2");
                        playSound("musicMenu2Muffled");
                        sounds.music2MenuMuffled.muted = true;
                        sounds.music2.muted = false;
                    }else if(level >= 14 && level <= 19){
                        playSound('menuSelect');
                        showDevtools = false;
                        cancelAnimationFrame(myReq);
                        startLevel();
                        sounds.music3MenuMuffled.muted = true;
                        sounds.music3.muted = false;
                        playSound('music3');
                        playSound('music3MenuMuffled');
                    }else if(level === 20){
                        playSound('menuSelect');
                        showDevtools = false;
                        cancelAnimationFrame(myReq);
                        startLevel();
                        pauseSound('music');
                        pauseSound('musicMenuMuffled');
                        pauseSound('music3');
                        pauseSound('music3MenuMuffled');

                        playSound('boss2bMusic');
                        playSound('boss2bMusicMenuMuffled');
                    }else {
                        playSound('menuSelect');
                        showDevtools = false;
                        cancelAnimationFrame(myReq);
                        startLevel();
                        sounds.music2MenuMuffled.muted = true;
                        sounds.music2.muted = false;
                    }
                    player.hp = level + 3;
                }

                console.log('showingDevtools');
                if(e.key=="w"){
                    playSound('menuScrollUp');
                    devtoolsSelectorY -= 1;
                }
                if(e.key=="a"){
                    if (devtoolsSelectorY === 0){
                        level -= 1;
                        if (level < 1){
                            level = numLevels;
                        }
                    }
                    playSound('menuScrollDown');
                    //graphicsSelector -= 1;
                }
                if(e.key=="s"){
                    playSound('menuScrollDown');
                    devtoolsSelectorY += 1;
                }
                if(e.key=="d"){
                    if (devtoolsSelectorY === 0){
                        level += 1;
                        if (level > numLevels){
                            level = 1
                        }
                    }
                    playSound('menuScrollUp');
                    //graphicsSelector += 1;
                }

                if (devtoolsSelectorY > 1){
                    devtoolsSelectorY = 0;
                }else if(devtoolsSelectorY < 0){
                    devtoolsSelectorY = 1;
                }
                
                return;
            } 

            if (showGraphics === true){


                if (event.key === "Enter"){
                    playSound('menuSelect');
                    showGraphics = false;
                    cancelAnimationFrame(myReq);

                    showOptions = true;
                    optionsSelector = 2;
                    showOptionsMenu();

                }

                if(e.key=="d" || e.key=="w"){
                    playSound('menuScrollUp');
                    graphicsSelector += 1;
                }
                if(e.key=="a" || e.key=="s"){
                    playSound('menuScrollDown');
                    graphicsSelector -= 1;
                }


                console.log(graphicsSelector);
                //allowing continuous scrolling through left/right
                if (graphicsSelector > 1){
                    graphicsSelector = 0;
                }else if(graphicsSelector < 0){
                    graphicsSelector = 1;
                }

                console.log(graphicsSelector);

                return;
            }

            if(e.key=="w"){
                pY = -1;
                pX = 0;
                playerDirection = "up";
                player.tryMove(0, -1);
                //console.log(pY);    
            }
            if(e.key=="s"){
                pY = 1;
                pX = 0;
                playerDirection = "down";
                player.tryMove(0, 1);
                //console.log(pY);
            }
            if(e.key=="a"){
                pY = 0;
                pX = -1;
                playerDirection = "left";
                player.tryMove(-1, 0);
                //console.log(pX);    
            }
            if(e.key=="d"){
                pY = 0;
                pX = 1;
                playerDirection = "right";
                player.tryMove(1, 0);
                //console.log(pX);    
            }

            if(e.key=="W" && moonShoes === true){
                player.tryMove(0, -2);
                playerDirection = "up";    
            } 
            if(e.key=="S" && moonShoes === true){
                player.tryMove(0, 2);
                playerDirection = "down";
            } 
            if(e.key=="A" && moonShoes === true){
                player.tryMove(-2, 0);
                playerDirection = "left";
            }
            if(e.key=="D" && moonShoes === true){
                player.tryMove(2, 0);
                playerDirection = "right";
            }

            if(e.key=="f"){
                playerDirection = "down";
                tick();    
            }
            //if(e.key=="g") moonShoes = true;
            
            if(e.key==="Enter" && readyToExit === true){
                    welldepleted = false  
                if(level === numLevels){
                    addScore(score, true); 
                    showTitle();
                }else if(level === 5){
                    showRpSection1();
                    level++;
                    playSound("newLevel");  
                }else if (level === 6){
                    animatingMutationSelection1 = true;
                    showRpSection2();
                    level += 1
                    playSound("newLevel");
                }else if(level === 7){
                    if(unlockDoor0 === true){
                        playSound("newLevel");
                        level++;
                        startLevel(Math.min(maxHp, player.hp+1),undefined, player.baseAttack);    
                    }else {
                        playSound("doorLocked");
                        return;
                    }
                }else if(level === 8 || level === 10 || level === 11 || level === 12){
                    if (unlockDoor0 === true && unlockDoor1 === true){
                        if(level === 12){
                            playSound("newLevel");
                            level++;
                            showRpSection5();
                        }else{
                            playSound("newLevel");
                            level++;
                        startLevel(Math.min(maxHp, player.hp+1),undefined, player.baseAttack);    
                        }     
                    }else {
                        playSound("doorLocked");
                        return;
                    }
                }else if (level === 13){
                    level = 21;
                    playSound("newLevel");
                    startLevel(Math.min(maxHp, player.hp+1),undefined, player.baseAttack);
                }else if(level === 19){
                    playSound("newLevel");
                    showRpSection6();    
                }
                else {
                    playSound("newLevel");
                    level++;
                    startLevel(Math.min(maxHp, player.hp+1),undefined, player.baseAttack);
                }
            }


        };

            if(e.key==="Enter" && readyToExit != true && readyToDrink != true &&readyToDamage2aBoss != true){
                if (level > 6 && level <= 13){
                    if(canPause2a === true){
                        monster2aPaused = true;
                        canPause2a = false;
                        playSound('shadowFreeze');    
                    }else {
                        monster2aPaused = false;
                        canPause2a = true;
                        playSound('shadowUnfreeze');          
                    }
            }
                
                

            }

            if(e.key==="Enter" && readyToDrink === true){
                playSound("well");
                welldepleted = true;
                readyToDrink = false;
                if(player.hp === maxHp){
                    score += 6;
                    if(numSpells < 6){
                        numSpells += 1;
                        player.addSpell();
                        numSpells += 1;
                        player.addSpell();
                    }
                }else{
                    player.hp += 6;
                    score += 3;
                    if(numSpells < 6){
                        numSpells += 1;
                        player.addSpell();
                    }
                }
                    for(let i=1;i<numTiles-1;i++){
                        let findwell = tiles[i].findIndex((tile) => tile instanceof Well);
                    if (findwell !== -1){
                            let tile = getTile(i, findwell);
                            tile.replace(EmptyWell);
                        }
                    }
            }

            if(e.key==="Enter" && readyToMutate === true){
                playSound("well");
                mutatedepleted = true;
                readyToMutate = false;
                moonShoes = true;
                    for(let i=1;i<numTiles-1;i++){
                        let findmutate = tiles[i].findIndex((tile) => tile instanceof Mutation1);
                    if (findmutate !== -1){
                            let tile = getTile(i, findmutate);
                            tile.replace(MutateFloor);
                    }
                }
            }    

            if(e.key==="Enter" && readyToDamage2aBoss === true){
                console.log('something done');
                readyToDamage2aBoss = false;

                tiles[4][3] = new MutateBossSpecialFloorActivator(4, 3);
                tiles[2][3] = new MutateFloor(2, 3);
                tiles[6][3] = new MutateFloor(6, 3);

                //bottom row buttons
                tiles[1][5] = new MutateFloor(1, 5);
                tiles[3][5] = new MutateFloor(3, 5);
                tiles[5][5] = new MutateFloor(5, 5);
                tiles[7][5] = new MutateFloor(7, 5);
                
            } 

            if(e.key>=1 && e.key<=6) player.castSpell(e.key-1);

            if(e.key==7) player.equipSword(0);
            if(e.key==8) player.equipArmor(0);

            if(e.key=="m"){
                if(soundStopped === false){
                    document.getElementById('audioSymbol').src='images/imgX.png';
                    pauseSound('music');
                    pauseSound('musicMenuMuffled'); 
                    soundStopped = true;
                }else if(soundStopped === true){
                    document.getElementById('audioSymbol').src='images/img.png';
                    playSound('music');
                    playSound('musicMenuMuffled');  
                    soundStopped = false;
                }
            }

            if(e.key=="`"){
                startLevel(Math.min(maxHp, player.hp),undefined, player.baseAttack);
            }

            if(e.key=="/"){
                numSpells = 6;
                numSword = 1;
                numArmor = 1;
                player.hp = 12;
                moonShoes = true;
                eaterSoul = true;
            }

            if (level === 20 && e.key=="Enter"){
                tick();
            }

            if(e.key=="Enter" && boss2bButtonRPushed === true && boss2bBombable === true && boss2bButtonRCooldown === 0 && reveal2bHelper === true){
                boss2bHP -= 8;
                boss2bHPCorrection +=8;
                    shakeAmount = 10;
                    screenshake();
                boss2bDamageAnimation = 34;
                drawBoss2bDamageAnimation();

                boss2bButtonRCooldown = 144;
                playSound('boss2bExplosion');
            }else if (e.key=="Enter" && level === 20 && boss2bButtonRPushed === true && boss2bBombable === false){
                playSound('doorLocked');
            }

    };

    document.querySelector("html").addEventListener("keydown", (e) => {
        if (e.key === "k" && eaterSoul === true) {
            eatsWalls = true;
            //console.log(eatsWalls);
        }
    });
    document.querySelector("html").addEventListener("keyup", (e) => {
        if (e.key === "k" && eaterSoul === true) {
            eatsWalls = false;
            //console.log(eatsWalls);
        }
    });

    document.addEventListener('keyup', function(event){
            if(event.key === "Escape" && gameState === "running" && animatingLevel2aTooltip != true){
                if(showOptions === false && showGraphics === false && showDevtools === false){
                    playSound('menuOpen');
                    sounds.musicMenuMuffled.muted = false;
                    sounds.music2MenuMuffled.muted = false;
                    sounds.bossmusicMenuMuffled.muted = false;
                    sounds.music3MenuMuffled.muted = false;
                    

                    sounds.music.muted = true;
                    sounds.music2.muted = true;
                    sounds.bossmusic.muted = true;
                    sounds.music3.muted = true;
                    

                    if (level === 20){
                        sounds.boss2bMusicMenuMuffled.muted = false;
                        sounds.boss2bMusic.muted = true;
                        alienFloaterX = 10000;
                        alienFloaterY = 10000;
                    }

                    showOptions = true;
                    showOptionsMenu();
                }else if(showGraphics === true){
                    playSound('menuOpen');
                    showGraphics = false;
                    cancelAnimationFrame(myReq);

                    showOptions = true;
                    optionsSelector = 2;
                    showOptionsMenu();
                }else if(showDevtools === true){
                    playSound('menuOpen');
                    showGraphics = showDevtools = false;
                    cancelAnimationFrame(myReq);


                    showOptions = true;
                    optionsSelector = 1;
                    showOptionsMenu();

                }else {
                    playSound('menuClose');
                    sounds.musicMenuMuffled.muted = true;
                    sounds.music2MenuMuffled.muted = true;
                    sounds.bossmusicMenuMuffled.muted = true;
                    sounds.music3MenuMuffled.muted = true;
                    sounds.boss2bMusicMenuMuffled.muted = true;

                    sounds.music.muted = false;
                    sounds.music2.muted = false;
                    sounds.bossmusic.muted = false;
                    sounds.music3.muted = false;
                    sounds.boss2bMusic.muted = false;

                    if (level === 20){
                        alienFloaterX = 160;
                        alienFloaterY = 160;
                        alienFloaterStatus = 'goingToB'
                    }



                    showOptions = false;

                    cancelAnimationFrame(myReq);
                }

                console.log(showOptions);
            }
    });

    

    setInterval(draw, 15);

    setupCanvas();
    setupCanvas2();

    initSounds(); 

    function muteAudio() {
        if(soundStopped === false){
            document.getElementById('audioSymbol').src='images/imgX.png';
            if (level <= 5){
                pauseSound('music');
                pauseSound('musicMenuMuffled'); 
            }else if (level === 6){
                pauseSound('bossmusic');
                pauseSound('bossmusicMenuMuffled'); 
            }else if (level >= 7 && level <= 12){
                pauseSound('music2');
                pauseSound('music2MenuMuffled'); 
            }else if (level === 13){
                //bosslevel2amusic
            }else if (level >= 14 && level <= 19){
                pauseSound('music3');
                pauseSound('music3MenuMuffled');
            }else if (level === 20){
                pauseSound('boss2bmusic');
                pauseSound('boss2bmusicMenuMuffled');
            }
            
            
            soundStopped = true;
        }else if(soundStopped === true){
            document.getElementById('audioSymbol').src='images/img.png';
            if (level <= 5){
                playSound('music');
                playSound('musicMenuMuffled');
            }else if (level === 6){
                playSound('bossmusic');
                playSound('bossmusicMenuMuffled'); 
            }else if (level >= 7 && level <= 12){
                playSound('music2');
                playSound('music2MenuMuffled'); 
            }else if (level === 13){
                //bosslevel2amusic
            }else if (level >= 14 && level <= 19){
                playSound('music3');
                playSound('music3MenuMuffled');
            }else if (level === 20){
                playSound('boss2bmusic');
                playSound('boss2bmusicMenuMuffled');
            }
            
              
            soundStopped = false;
        }
    }
    
</script>
