<!DOCTYPE html>
<title>Yew's RogueLike</title>
<link rel="icon" type="image/x-icon" href="images/favicon.ico">
<link rel="stylesheet" href="styles.css">

<body><img id="audioSymbol" src="images/img.png" onclick="muteAudio()"/></body>

<canvas></canvas>
<div style="display:none;">
  <img id="rp0image"
       src="images/spritesheet.png"
       width="512" height="16">
</div>
<script src="js/game.js"></script>
<script src="js/map.js"></script>
<script src="js/tile.js"></script>
<script src="js/monster.js"></script>
<script src="js/util.js"></script>
<script src="js/spell.js"></script>
<script src="js/sword.js"></script>
<script src="js/armor.js"></script>
<script src="js/Controller/Controller.min.js"></script>
<script src="js/Controller/Controller.layouts.min.js"></script>
<script src="js/Controller/controllerInputs.js"></script>

<script>
    moonShoes = false;
    tileSize = 64;
    numTiles = 9;
    uiWidth = 4;
    level = 1;
    maxHp = 12;

    spritesheet = new Image();
    spritesheet.src = 'images/spritesheet.png';
    spritesheet.onload = showTitle;
                             
    gameState = "loading";  

    startingHp = 3; 
    numLevels = 8;    

    shakeAmount = 0;       
    shakeX = 0;                 
    shakeY = 0;         

    document.querySelector("html").onkeypress = function(e){
        //console.log(e.key);
        if(gameState == "title"){
            animatingTitle = false;
            gameState = "rpSection0";
            showRpSection0();                              
        }else if(gameState === "rpSection0"){
            animating = false;
            gameState = "running";
            startGame();              
        }else if(gameState === "rpSection1"){
            startBossLevel(Math.min(maxHp, player.hp+1),undefined, player.baseAttack);
        }else if(gameState === "rpSection2"){
            startLevel(Math.min(maxHp, player.hp+1),undefined, player.baseAttack);  
        }

        else if(gameState == "dead"){                             
            showTitle();                                        
        }else if(gameState == "running"){ 
            if(e.key=="w") player.tryMove(0, -1);
            if(e.key=="s") player.tryMove(0, 1);
            if(e.key=="a") player.tryMove(-1, 0);
            if(e.key=="d") player.tryMove(1, 0);

            if(e.key=="W" && moonShoes === true) player.tryMove(0, -2);
            if(e.key=="S" && moonShoes === true) player.tryMove(0, 2);
            if(e.key=="A" && moonShoes === true) player.tryMove(-2, 0);
            if(e.key=="D" && moonShoes === true) player.tryMove(2, 0);

            if(e.key=="f") tick();
            //if(e.key=="g") moonShoes = true;
            
            if(e.key==="Enter" && readyToExit === true){
                    playSound("newLevel");
                    welldepleted = false  
                if(level === numLevels){
                    addScore(score, true); 
                    showTitle();
                }else if(level === 5){
                    showRpSection1();
                    level++;  
                }else if (level === 7){
                    showRpSection2();
                    level++;
                }

                else{
                    level++;
                    startLevel(Math.min(maxHp, player.hp+1),undefined, player.baseAttack);
                }
            }            
        };

            if(e.key==="Enter" && readyToDrink === true){
                playSound("well");
                welldepleted = true;
                readyToDrink = false;
                if(player.hp === maxHp){
                    score += 6;
                    if(numSpells < 6){
                        numSpells += 1;
                        player.addSpell();
                        numSpells += 1;
                        player.addSpell();
                    }
                }else{
                    player.hp += 6;
                    score += 3;
                    if(numSpells < 6){
                        numSpells += 1;
                        player.addSpell();
                    }
                }
                    for(let i=1;i<numTiles-1;i++){
                        let findwell = tiles[i].findIndex((tile) => tile instanceof Well);
                        console.log(findwell);
                    if (findwell !== -1){
                            let tile = getTile(i, findwell);
                            tile.replace(EmptyWell);
                    }
                }
            }

            if(e.key==="Enter" && readyToMutate === true){
                playSound("well");
                mutatedepleted = true;
                readyToMutate = false;
                moonShoes = true;
                    for(let i=1;i<numTiles-1;i++){
                        let findmutate = tiles[i].findIndex((tile) => tile instanceof Mutation1);
                        console.log(findmutate);
                    if (findmutate !== -1){
                            let tile = getTile(i, findmutate);
                            tile.replace(MutateFloor);
                    }
                }
            }    

            if(e.key>=1 && e.key<=6) player.castSpell(e.key-1);

            if(e.key==7) player.equipSword(0);
            if(e.key==8) player.equipArmor(0);

            if(e.key=="m"){
                if(soundStopped === false){
                    document.getElementById('audioSymbol').src='images/imgX.png';
                    pauseSound('music'); 
                    soundStopped = true;
                }else if(soundStopped === true){
                    document.getElementById('audioSymbol').src='images/img.png';
                    playSound('music'); 
                    soundStopped = false;
                }
            }
    };
    

    setInterval(draw, 15);

    setupCanvas();

    initSounds(); 

    function muteAudio() {
        if(soundStopped === false){
            document.getElementById('audioSymbol').src='images/imgX.png';
            pauseSound('music'); 
            soundStopped = true;
        }else if(soundStopped === true){
            document.getElementById('audioSymbol').src='images/img.png';
            playSound('music'); 
            soundStopped = false;
        }
    }
    
</script>
